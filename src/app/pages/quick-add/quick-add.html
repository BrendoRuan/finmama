<div class="page">
  <header class="topbar">
    <h1>Lançar</h1>
    <div class="type-toggle" role="tablist" aria-label="Tipo">
      <button class="pill" [class.active]="type==='ENTRADA'" (click)="setType('ENTRADA')">Entrada</button>
      <button class="pill" [class.active]="type==='SAIDA'" (click)="setType('SAIDA')">Saída</button>
    </div>
  </header>

  <!-- CARD PRINCIPAL -->
  <section class="card">
    <label class="label">Valor</label>
    <input
      class="input big"
      inputmode="decimal"
      placeholder="0,00"
      [(ngModel)]="amountText"
    />

    <div class="row">
      <div class="col">
        <label class="label">Data</label>
        <input class="input" type="date" [(ngModel)]="dateInput" />
      </div>
    </div>

    <label class="label">Observação (opcional)</label>
    <input class="input" placeholder="Ex: feira, remédio..." [(ngModel)]="note" />
  </section>

  <!-- CATEGORIAS -->
  <section class="card">
    <div class="card-title">
      <h2>Categorias</h2>
      <span class="hint">toque para escolher</span>
    </div>

    <div class="chips">
      <button
        *ngFor="let c of categories"
        class="chip"
        [class.selected]="selectedCategoryId===c.id"
        [class.disabled]="!isCategoryAllowed(c)"
        [disabled]="!isCategoryAllowed(c)"
        (click)="pickCategory(c.id)"
      >
        <span class="dot" [style.background]="c.color"></span>
        <span class="txt">{{ c.name }}</span>
      </button>
    </div>
  </section>

  <!-- BOTÃO SALVAR (AGORA AQUI) -->
  <button class="btn primary save-btn" (click)="save()" [disabled]="saving">
    Salvar
  </button>

  <!-- INVESTIMENTO -->
  <section class="card investment-card">
    <div class="card-title">
      <h2>Investimento</h2>
      <span class="hint">Reserva de emergência (CDI)</span>
    </div>

    <label class="label">Valor para investir</label>
    <input
      class="input big"
      inputmode="decimal"
      placeholder="0,00"
      [(ngModel)]="investmentAmountText"
    />

    <button
      class="btn investment-btn"
      (click)="addInvestment()"
      [disabled]="investing">
      Aplicar
    </button>
  </section>

  <!-- TOAST -->
  <div class="toast" *ngIf="toast.show">
    <span>{{ toast.text }}</span>
    <button *ngIf="lastCreatedId" class="link" (click)="undo()">Desfazer</button>
  </div>

 <section class="card card-bill">
  <div class="card-title">
    <h2>Fatura do Cartão</h2>
    <span class="hint">Escolha o cartão e informe valor e parcelas</span>
  </div>

  <!-- SELEÇÃO DO CARTÃO -->
  <label class="label">Cartão</label>
  <div class="chips">
    <button
      *ngFor="let c of cards"
      class="chip"
      [class.selected]="selectedCardId === c.id"
      (click)="pickCard(c.id)">
      <span class="txt">{{ c.name }}</span>
    </button>
  </div>

  <label class="label">Valor da fatura</label>
  <input class="input big" inputmode="decimal" placeholder="0,00" [(ngModel)]="faturaAmountText" />

  <label class="label">Quantidade de parcelas</label>
  <input class="input" type="number" min="1" [(ngModel)]="faturaQuantity" />

  <button class="btn primary" (click)="saveCardBill()" [disabled]="saving || !selectedCardId">Salvar Fatura</button>
</section>


</div>
